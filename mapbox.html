<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Mapbox Map with Smooth Marker Rotation and Satellite View</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <!-- Include Mapbox GL JS CSS -->
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    </style>
</head>
<body>
    <div id="map"></div>

    <!-- Include Mapbox GL JS Script -->
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>

    <!-- Your Mapbox Initialization Code -->
    <script>
        // Ensure the Mapbox GL JS library has loaded before running this script
        mapboxgl.accessToken = 'pk.eyJ1IjoibWVza2FuZGFyaTgwIiwiYSI6ImNsend5b3NnMTBvZXoya3Nkb2FhbWxpbmsifQ.R5vEllBDk5lTK9eTlpBFLw';

        // Initialize the map with satellite view
        const map = new mapboxgl.Map({
            container: 'map', // ID of the container where the map will be displayed
            style: 'mapbox://styles/mapbox/streets-v11', // Map style for satellite view
            center: [-74.5, 40], // Starting position [lng, lat]
            zoom: 9 // Starting zoom level
        });

        // Array of latitude, longitude, and bearing angle
        const coordinatesArray = [
            { lngLat: [-74.5, 40.1], bearing: 45 },
            { lngLat: [-74.51, 40.11], bearing: 45 },
            { lngLat: [-74.52, 40.12], bearing: 45 },
            { lngLat: [-74.53, 40.13], bearing: 45 },
            { lngLat: [-74.54, 40.14], bearing: 45 },
            { lngLat: [-74.55, 40.15], bearing: 45 },
            { lngLat: [-74.555, 40.16], bearing: 70 },
            { lngLat: [-74.56, 40.17], bearing: 80 },
            { lngLat: [-74.565, 40.18], bearing: 80 },
            { lngLat: [-74.57, 40.19], bearing: 80 },
              // New position 3 with 135 degrees bearing
        ];

        let currentIndex = 0;

        // Add the path line to the map as a LineString layer
        map.on('load', function () {
            map.addSource('path', {
                'type': 'geojson',
                'data': {
                    'type': 'Feature',
                    'properties': {},
                    'geometry': {
                        'type': 'LineString',
                        'coordinates': coordinatesArray.map(point => point.lngLat)
                    }
                }
            });

            map.addLayer({
                'id': 'path-layer',
                'type': 'line',
                'source': 'path',
                'layout': {
                    'line-join': 'round',
                    'line-cap': 'round'
                },
                'paint': {
                    'line-color': '#ff0000', // Path line color
                    'line-width': 4          // Path line width
                }
            });
        });

        // Create a custom marker element
        const customMarker = document.createElement('div');
        customMarker.style.backgroundImage = 'url(https://upload.wikimedia.org/wikipedia/commons/thumb/7/7d/Plane_icon.svg/1200px-Plane_icon.svg.png)'; // Set your custom icon URL
        customMarker.style.width = '25px';  // Set the width of the marker
        customMarker.style.height = '25px'; // Set the height of the marker
        customMarker.style.backgroundSize = '100%';
        customMarker.style.transition = 'transform 5s'; // Smooth transition for rotation

        // Create a marker and add it to the map
        const marker = new mapboxgl.Marker({ element: customMarker })
            .setLngLat(coordinatesArray[currentIndex].lngLat) // Set the initial position
            .addTo(map);

        // Function to interpolate between two coordinates
        function interpolate(start, end, progress) {
            return [
                start[0] + (end[0] - start[0]) * progress,
                start[1] + (end[1] - start[1]) * progress
            ];
        }

        // Function to smoothly move the marker between points
        function moveMarker(start, end, duration) {
            const startTime = performance.now();

            function animate(time) {
                const elapsedTime = time - startTime;
                const progress = Math.min(elapsedTime / duration, 1);

                // Calculate the intermediate position
                const newPosition = interpolate(start.lngLat, end.lngLat, progress);
                marker.setLngLat(newPosition);

                // Calculate the interpolated bearing and apply rotation
                const newBearing = start.bearing + (end.bearing - start.bearing) * progress;
                customMarker.style.transform += `rotate(${newBearing}deg)`;
                //map.setBearing(newBearing);

                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    currentIndex = (currentIndex + 1) % coordinatesArray.length;
                    moveMarker(end, coordinatesArray[currentIndex], duration);
                }
            }

            requestAnimationFrame(animate);
        }

        // Start moving the marker smoothly between points with rotation
        moveMarker(coordinatesArray[currentIndex], coordinatesArray[(currentIndex + 1) % coordinatesArray.length], 2000);
    </script>
</body>
</html>
